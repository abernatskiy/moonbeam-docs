---
title: Index Moonbeam Data with Subsquid
description: Learn how to use Subsquid, a query node framework for Substrate-based chains, to index and process Substrate and EVM data for Moonbeam and Moonriver.
---

# Indexing Moonbeam with Subsquid

![Subsquid Banner](/images/builders/integrations/indexers/subsquid/subsquid-banner.png)

## Introduction {: #introduction }

[Subsquid](https://subsquid.io){target=_blank} is an ETL (extract, transform, and load) framework that includes a powerful GraphQL server with support for pagination and custom resolvers. The framework uses PostgreSQL for data persistence when it serves GraphQL, but it is also capable of writing its output to file-based datasets in a variety of formats (CSV, Parquet, JSON/JSONL) to S3-compatible clouds or local files. Its [superb sync performance](https://docs.subsquid.io/migrate/subsquid-vs-thegraph/){target=_blank} is achieved by using specialized data lakes called [Archives](https://docs.subsquid.io/archives/overview/){target=_blank} for indexing the bulk of data.

Subsquid indexers are regular NodeJS processes that can execute arbitrary code during the data transform phase. This makes it easy to enrich the blockchain data with data from other sources such as IPFS and external APIs.

The framework has native and full support both for Ethereum Virtual Machine (EVM) and Substrate. Moonbeam is a Substrate-based smart contact platform that is EVM-compatible, and Subsquid can be used to index either just the data exposed to its EVM layer or the complete Substrate data:

* The EVM-native approach offers simplicity and better sync performance. It is the recommended approach for applications that do not require Substrate data. Subsquid provides a fully automatic tool for generating indexers that extract specific events and method calls of specific contracts using this approach.

* The Substrate-native approach provides the flexibility to process EVM logs and Substrate data (events, extrinsics, and storage items) within the same project and serve the results through a single GraphQL endpoint.

This guide will show you how to create EVM-native and Substrate-native projects with Subsquid and configure them to index Moonbeam data. 

--8<-- 'text/disclaimers/third-party-content-intro.md'

## Checking Prerequisites {: #checking-prerequisites }

To get started with Subsquid, you'll need:

- [Node.js](https://nodejs.org/en/download/){target=_blank} version 16 or newer
- [Docker](https://docs.docker.com/get-docker/){target=_blank}
- [Squid CLI](https://docs.subsquid.io/squid-cli/installation/){target=_blank} v2.1.0 or newer

[//]: # (!!!! Update the squid cli version)

!!! note
    The squid template is not compatible with `yarn`, so you'll need to use `npm` instead.

## Build an Ethereum-native indexer {: #index-ethereum-contracts }

You can build a EVM-native indexer from scratch or with the indexer-generating tool. Consider using an autogenerated indexer if you need raw events and transactions data in a GraphQL API or a file-based dataset.

#### EVM-native indexer from scratch {: #evm-native-indexer-from-scratch }

Create a EVM Subsquid project and configure it for Moonbeam:

1. Create a Subsquid project using the generic [EVM template](https://github.com/subsquid-labs/squid-evm-template){target=_blank}:

    ```
    sqd init <insert-indexer-name> --template evm
    ```

2. Configure the [main indexer object](https://docs.subsquid.io/evm-indexing/evm-processor/){target=_blank} to use Moonbeam data sources by modifying the call to its `setDataSource()` method at `src/processor.ts`:

    === "Moonbeam"
        ```
        export const processor = new EvmBatchProcessor()
          .setDataSource({
            chain: /* add a Moonbeam RPC URL here */,
            // Resolves to the URL of the Subsquid-maintained Moonbeam EVM Archive
            archive: lookupArchive("moonbeam", { type: "EVM" })
          });
        ```

    === "Moonriver"
        ```
        export const processor = new EvmBatchProcessor()
          .setDataSource({
            chain: /* add a Moonriver RPC URL here */,
            // Resolves to the URL of the Subsquid-maintained Moonriver EVM Archive
            archive: lookupArchive("moonriver", { type: "EVM" })
          });
        ```

    === "Moonbase Alpha"
        ```
        export const processor = new EvmBatchProcessor()
          .setDataSource({
            chain: /* add a Moonbase RPC URL here */,
            // Resolves to the URL of the Subsquid-maintained Moonbase EVM Archive
            archive: lookupArchive("moonbase", { type: "EVM" })
          });
        ```

[//]: # (???? Are the EVM and Substrate RPCs interchangeable for Moonbeam networks)

Your new Subsquid indexer is now configured to use Moonbeam data. Get started with the development by following the [EVM quickstart guide](https://docs.subsquid.io/quickstart/quickstart-ethereum/){target=_blank}.

#### Autogenerating an EVM-native indexer {: #autogenerating-an-evm-native-indexer }

This approach allows for no-code generation of indexers that retrieve EVM transaction and/or event data for Moonbeam/Moonriver/Moonbase contracts. The generated indexers can serve the raw blockchain data via a GraphQL API from a PostgreSQL database or write it to file-based datasets. Proceed as follows:

1. Create a Subsquid project using the [ABI template](https://github.com/subsquid-labs/squid-abi-template){target=_blank}:

    ```
    sqd init <insert-indexer-name> --template abi
    ```

2. Configure and run the indexer generating tool using its [CLI](https://docs.subsquid.io/quickstart/quickstart-abi/){target=_blank} or by writing a [YAML configuration file](https://docs.subsquid.io/basics/squid-gen/){target=_blank} then feeding it to the tool. CLI only supports a subset of the tool functionality, namely indexing a single contract to a PostgreSQL database / GraphQL API. Use the configuration file if your use case involves multiple contracts or targets a file-based dataset.

    Make sure to configure the tool to use the Moonbeam data sources (Archive and RPC endpoint).

3. Prepare your indexer for launching and run it as described in the guide for the configuration style you used ([CLI](https://docs.subsquid.io/quickstart/quickstart-abi/){target=_blank}, [configuration file](https://docs.subsquid.io/basics/squid-gen/){target=_blank}).

Your new indexer should now be scraping contract events and transactions from one of the Moonbeam blockchains and sending the data to the destination of your choice.

## Index Substrate Data on Moonbeam {: #index-substrate-calls-events }

This approach enables seamless indexing of Substrate and EVM data from Moonbeam, Moonriver or Moonbase Alpha. Create a Substrate Subsquid project and configure it for your network of choice:

1. Create a Subsquid project using the generic [Substrate template](https://github.com/subsquid-labs/squid-substrate-template){target=_blank}:

    ```
    sqd init <insert-indexer-name> --template substrate
    ```

2. Update the [`typegen.json` file](https://docs.subsquid.io/substrate-indexing/squid-substrate-typegen/){target=_blank} and re-generete TypeScript interface classes for your data. Depending on the network you're indexing data on, the `specVersions` value in the file should be configured as follows:

    === "Moonbeam"
        ```
        "specVersions": "https://moonbeam.archive.subsquid.io/graphql",
        ```

    === "Moonriver"
        ```
        "specVersions": "https://moonriver.archive.subsquid.io/graphql",
        ```

    === "Moonbase Alpha"
        ```
        "specVersions": "https://moonbase.archive.subsquid.io/graphql",
        ```

    You may also want to list events, calls, storage items and constants of interest within `typegen.json` while you're at it. When done, regenerate TypeScript interface classes with

    ```
    sqd typegen
    ```

2. Configure the [main indexer object](https://docs.subsquid.io/evm-indexing/evm-processor/){target=_blank} to use Moonbeam data sources by modifying the call to its `setDataSource()` method at `src/processor.ts`. Make sure to use a *Substrate* Archive for your network of choice:

    === "Moonbeam"
        ```
        export const processor = new SubstrateBatchProcessor()
          .setDataSource({
            chain: /* add a Moonbeam RPC URL here */,
            // Resolves to "https://moonbeam.archive.subsquid.io"
            archive: lookupArchive("moonbeam", { type: "Substrate" }),
          });
        ```

    === "Moonriver"
        ```
        export const processor = new SubstrateBatchProcessor()
          .setDataSource({
            chain: /* add a Moonriver RPC URL here */,
            // Resolves to "https://moonriver.archive.subsquid.io"
            archive: lookupArchive("moonriver", { type: "Substrate" }),
          });
        ```

    === "Moonbase Alpha"
        ```
        export const processor = new SubstrateBatchProcessor()
          .setDataSource({
            chain: /* add a Moonbase RPC URL here */,
            // Resolves to "https://moonbase.archive.subsquid.io"
            archive: lookupArchive("moonbase", { type: "Substrate" }),
          });
        ```

Your new Subsquid indexer is now configured to use Moonbeam data. Get started with the development by following the [Substrate quickstart guide](https://docs.subsquid.io/quickstart/quickstart-substrate/){target=_blank}. Take a look at the [Frontier EVM support page](https://docs.subsquid.io/substrate-indexing/evm-support/){target=_blank} if you want to index EVM data within a Substrate-native indexer. For a step-by-step tutorial on building an indexer in this style, check out the [Index NFT Token Transfers on Moonbeam with Subsquid](/tutorials/integrations/nft-subsquid){target=_blank} page.

--8<-- 'text/disclaimers/third-party-content.md'
